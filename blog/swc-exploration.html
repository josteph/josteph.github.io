<!DOCTYPE html><html lang="en"><title>Joshua Stephen</title><meta name="robots" content="index,follow"/><meta name="application-name" content="Joshua Stephen"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="default"/><meta name="apple-mobile-web-app-title" content="Joshua Stephen"/><meta name="description" content="A web developer passionate about javascript all around the web."/><meta name="format-detection" content="telephone=no"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#FFFFFF"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png"/><meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@jostephhh"/><meta name="twitter:creator" content="@jostephhh"/><meta name="twitter:image" content="/icons/apple-icon-120x120.png"/><meta property="og:image" content="/icons/apple-icon-120x120.png"/><meta property="og:type" content="website"/><meta property="og:site_name" content="jostephhh"/><meta property="og:url" content="https://josteph.github.io"/><meta property="og:title" content="Joshua Stephen"/><meta property="og:description" content="A web developer passionate about javascript all around the web."/><link rel="canonical" href="https://josteph.github.io"/><link rel="manifest" href="/manifest.json"/><script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://josteph.github.io/"}</script><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Exploring SWC, a Rust Based Transpiler</title><meta content="Comparing with esbuild and list out current issues / edge cases for swc." name="description"/><meta property="og:site_name" content="Exploring SWC, a Rust Based Transpiler"/><meta property="og:description" content="Comparing with esbuild and list out current issues / edge cases for swc."/><meta property="og:title" content="Exploring SWC, a Rust Based Transpiler"/><meta name="twitter:title" content="Exploring SWC, a Rust Based Transpiler"/><meta name="twitter:description" content="Comparing with esbuild and list out current issues / edge cases for swc."/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-tomorrow.css" as="script"/><link href="https://unpkg.com/prismjs@0.0.1/themes/prism-tomorrow.css" rel="stylesheet"/><script type="application/ld+json">{"@context":"http://schema.org","@graph":[{"@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://josteph.github.io/blog/undefined","name":"Exploring SWC, a Rust Based Transpiler"}}]},{"@context":"http://schema.org","@type":"BlogPosting","url":"https://josteph.github.io/blog/undefined","alternateName":"Joshua Stephen","name":"Exploring SWC, a Rust Based Transpiler","headline":"Exploring SWC, a Rust Based Transpiler","description":"Comparing with esbuild and list out current issues / edge cases for swc.","author":{"@type":"Person","name":"Joshua Stephen"},"publisher":{"@type":"Organization","url":"https://josteph.github.io","logo":"icons/apple-icon.png","name":"Joshua Stephen"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://josteph.github.io"}}]}</script><meta name="next-head-count" content="12"/><link rel="preload" href="https://josteph.github.io/_next/static/css/459265bd12a067486d56.css" as="style"/><link rel="stylesheet" href="https://josteph.github.io/_next/static/css/459265bd12a067486d56.css" data-n-g=""/><link rel="preload" href="https://josteph.github.io/_next/static/css/3c136a69150d1083b2c5.css" as="style"/><link rel="stylesheet" href="https://josteph.github.io/_next/static/css/3c136a69150d1083b2c5.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="https://josteph.github.io/_next/static/chunks/webpack-b429e1369fc016e42d18.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/framework-73e320d4796cb275c431.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/597-9e7fe0b578c289b3627a.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/288-288c36fbcb66f88991b1.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/main-7713a1ef2965e1d091b8.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/pages/_app-d6d1a2ad44c75b0a7e7c.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/pages/blog/%5Bslug%5D-eccc4aa7201462883f8c.js" as="script"/></head><body><div id="__next"><header class="navbar"><nav class="nav-wrapper"><div class="nav-logo"><a href="/">Josteph</a></div></nav></header><main class="main-container"><article class="blog_page_articleContainer__3ejFe"><h1 id="exploring-swc-a-rust-based-transpiler">Exploring SWC, a Rust Based Transpiler<a href="#exploring-swc-a-rust-based-transpiler" aria-hidden="true" tabindex="-1"><span class="icon icon-link">🔗</span></a></h1>
<p>Published on April 9, 2021</p>
<hr>
<h2 id="table-of-contents">Table of Contents<a href="#table-of-contents" aria-hidden="true" tabindex="-1"><span class="icon icon-link">🔗</span></a></h2>
<ul>
<li>
<p><a href="#introduction">Introduction</a></p>
</li>
<li>
<p><a href="#older-browsers-support">Older Browsers Support</a></p>
</li>
<li>
<p><a href="#discovered-issues">Discovered Issues</a></p>
<ul>
<li><a href="#export-default-is-not-evaluated">Export default is not evaluated</a></li>
<li><a href="#swc-plugins">SWC Plugins</a></li>
</ul>
</li>
<li>
<p><a href="#conclusion">Conclusion</a></p>
</li>
</ul>
<h2 id="introduction">Introduction<a href="#introduction" aria-hidden="true" tabindex="-1"><span class="icon icon-link">🔗</span></a></h2>
<p>In the last <a href="/blog/esbuild-exploration">blog</a>, we have talked about how to use esbuild programmatically in order to boost your build time performance. Not to forget about babel, a lot of transformations that we are not aware of using it in babel, might not be supported in either esbuild or swc.</p>
<p>Also a bit disclaimer about using these new build tools written in go / rust, they are <strong>not fully stable yet</strong>. Although they are actively being developed, try to be extra careful when you decide to use this on production!</p>
<p>What I am going to discuss in this blog is about some edge cases you should know before even using swc.</p>
<p class="hint tip">This blog was written when I used swc <strong>1.2.51</strong>, as of this article's publish date.</p>
<h2 id="older-browsers-support">Older Browsers Support<a href="#older-browsers-support" aria-hidden="true" tabindex="-1"><span class="icon icon-link">🔗</span></a></h2>
<p>Discussing about older browsers, you might want to ship your code in <strong>ES5</strong> format. Babel has <a href="https://babeljs.io/docs/en/babel-preset-env" target="_blank" rel="nofollow noopener noreferrer">preset-env</a> which actually transpiles all ES5+ syntax to be compatible with ES5.</p>
<p>As mentioned in the previous <a href="/blog/esbuild-exploration">blog</a>, esbuild currently does not support ES5 syntax transformations. For safety, you can try esbuild for bundling server code instead or use it in development build like how <a href="https://vitejs.dev/" target="_blank" rel="nofollow noopener noreferrer">Vite</a> does.</p>
<p>On the other hand, SWC (what we are going to talk about it in this blog), does support ES5 syntax transformations. Personally I didn't encounter any weird issue with its ES5 syntax transformations prior writing this blog, when trying it out in a large codebase. Set the target to <code>es5</code> and if you want, you can explore about <a href="https://swc.rs/docs/preset-env/" target="_blank" rel="nofollow noopener noreferrer">swc preset-env</a>.</p>
<h2 id="discovered-issues">Discovered Issues<a href="#discovered-issues" aria-hidden="true" tabindex="-1"><span class="icon icon-link">🔗</span></a></h2>
<p>Below are several issues I personally encountered, I personally hope in the future SWC would focus on API stabilization instead.</p>
<h3 id="export-default-is-not-evaluated">Export default is not evaluated<a href="#export-default-is-not-evaluated" aria-hidden="true" tabindex="-1"><span class="icon icon-link">🔗</span></a></h3>
<p>This is a quite interesting thing I just discovered during my years in Frontend development 😅.
We have a file called <code>get.js</code>, let's take a look about the original code here:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// code here</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>And here's the result from transpiling using SWC:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// code here</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span><span class="token keyword module">default</span> <span class="token operator">=</span> get<span class="token punctuation">;</span>
</code></pre></div>
<p>What do you think would happen if another place import this file? Let's say there is <code>index.js</code> that actually re-export <code>get.js</code> file.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> _get<span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'set'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> _set<span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'del'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> _del<span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token keyword module">default</span> <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _get <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./get'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _set <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./set'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _del <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./del'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _default <span class="token operator">=</span> <span class="token punctuation">{</span>
  get<span class="token operator">:</span> _get<span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">,</span>
  set<span class="token operator">:</span> _set<span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">,</span>
  del<span class="token operator">:</span> _del<span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token keyword module">default</span> <span class="token operator">=</span> _default<span class="token punctuation">;</span>
</code></pre></div>
<p>If you try to console <code>_default</code> object, it will result in:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
  get<span class="token operator">:</span> <span class="token keyword nil">undefined</span><span class="token punctuation">,</span>
  set<span class="token operator">:</span> fn<span class="token punctuation">,</span>
  del<span class="token operator">:</span> fn<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Or even scarier, I bundled these as 3rd party library with webpack, resulting in with this error:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token known-class-name class-name">TypeError</span><span class="token operator">:</span> undefinedundefined is not defined
</code></pre></div>
<p>What happened here? I honestly didn't know until I read about this <a href="https://github.com/webpack/webpack/issues/7767" target="_blank" rel="nofollow noopener noreferrer">spec from webpack</a>.</p>
<p><strong>Lessons learned:</strong></p>
<ol>
<li>
<p>When writing a 3rd party library, we need to be extremely careful by knowing how other bundler works. Especially webpack and rollup, they might have different specs in mind. This is only just one example that things could go very wrong!</p>
</li>
<li>
<p>Babel might already be aware about this issue, or we just got off lucky. Babel will transpile into following which actually does the evaluation beforehand:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token keyword module">default</span> <span class="token operator">=</span> get<span class="token punctuation">;</span> <span class="token comment">// exports function first</span>

<span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// code here</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
</ol>
<hr>
<p>To conclude this issue, the safest code when exporting a function is:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// code here</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> get<span class="token punctuation">;</span>
</code></pre></div>
<p>Which will transpile to:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token keyword module">default</span> <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// code here</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> _default <span class="token operator">=</span> get<span class="token punctuation">;</span> <span class="token comment">// evaluate the function first</span>
exports<span class="token punctuation">.</span><span class="token keyword module">default</span> <span class="token operator">=</span> _default<span class="token punctuation">;</span>
</code></pre></div>
<h3 id="swc-plugins">SWC Plugins<a href="#swc-plugins" aria-hidden="true" tabindex="-1"><span class="icon icon-link">🔗</span></a></h3>
<p>So I've been writing a swc plugin for emotion that behaves similarly as <a href="https://github.com/emotion-js/emotion/tree/master/packages/babel-plugin" target="_blank" rel="nofollow noopener noreferrer">babel-emotion-plugin</a>.</p>
<p>SWC plugin as of this blog was written, is highly unstable. See this <a href="https://github.com/swc-project/swc/issues/785" target="_blank" rel="nofollow noopener noreferrer">issue</a>, even the example plugin is not working. But since it has already been patched, I decided to give it a try as well.</p>
<p>Below are the edge cases that I stumbled upon writing a plugin in version <code>1.2.51</code></p>
<ol>
<li>
<p>If you are writing your syntax in commonjs, you must be aware that the <code>Visitor</code> class is exported as default. So you need to import it differently:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">Visitor</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@swc/core/Visitor'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">EmotionStyledTransformer</span> <span class="token keyword">extends</span> <span class="token class-name">Visitor</span> <span class="token punctuation">{</span>
  <span class="token function">visitCallExpression</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// code</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> emotionPlugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EmotionStyledTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> emotionPlugin<span class="token punctuation">;</span>
</code></pre></div>
</li>
<li>
<p>Plugin does not work with <code>transformFile</code>, you need to use <code>transformFileSync</code> as alternative. Otherwise, it will give you weird <code>Unexpected token o in JSON</code> error. This is probably a mishandled logic problem in <code>@swc/core</code>, specifically in <code>parseFile</code> method (please do correct me if I am wrong here). It is actually doing <code>JSON.parse(&#x3C;Promise>)</code> 👻</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> transformFileSync<span class="token punctuation">,</span> plugins <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@swc/core'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">transformFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    plugin<span class="token operator">:</span> <span class="token function">plugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span>emotionPlugin<span class="token punctuation">.</span><span class="token method function property-access">visitProgram</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span>emotionPlugin<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token spread operator">...</span>swcOptions<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">throw</span> error<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
</li>
<li>
<p>You might encounter error like <code>visitTsType method is not implemented</code>. I'm not sure about this, but it seems you can't use plugin together with a typescript file that specifies the typings.</p>
</li>
</ol>
<h2 id="conclusion">Conclusion<a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link">🔗</span></a></h2>
<p>Well, it is how it is. SWC is more alpha version of Babel, so please be extra careful when migrating specifically a large codebase from Babel.</p>
<p>Despite having encoutered the issues above, this trial was quite fun, I also have discovered about hidden webpack spec that I wasn't aware of ✌️.</p>
<p>Now let's wait for the exciting future: <strong>esbuild fully supports ES5 syntax transformations</strong> or <strong>SWC stabilization</strong>.</p>
<hr>
</article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"swc-exploration","meta":{"title":"Exploring SWC, a Rust Based Transpiler","description":"Comparing with esbuild and list out current issues / edge cases for swc.","published":"April 9, 2021"},"content":"\u003ch1 id=\"exploring-swc-a-rust-based-transpiler\"\u003eExploring SWC, a Rust Based Transpiler\u003ca href=\"#exploring-swc-a-rust-based-transpiler\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e🔗\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003ePublished on April 9, 2021\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"table-of-contents\"\u003eTable of Contents\u003ca href=\"#table-of-contents\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e🔗\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#older-browsers-support\"\u003eOlder Browsers Support\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#discovered-issues\"\u003eDiscovered Issues\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#export-default-is-not-evaluated\"\u003eExport default is not evaluated\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#swc-plugins\"\u003eSWC Plugins\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#conclusion\"\u003eConclusion\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"introduction\"\u003eIntroduction\u003ca href=\"#introduction\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e🔗\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIn the last \u003ca href=\"/blog/esbuild-exploration\"\u003eblog\u003c/a\u003e, we have talked about how to use esbuild programmatically in order to boost your build time performance. Not to forget about babel, a lot of transformations that we are not aware of using it in babel, might not be supported in either esbuild or swc.\u003c/p\u003e\n\u003cp\u003eAlso a bit disclaimer about using these new build tools written in go / rust, they are \u003cstrong\u003enot fully stable yet\u003c/strong\u003e. Although they are actively being developed, try to be extra careful when you decide to use this on production!\u003c/p\u003e\n\u003cp\u003eWhat I am going to discuss in this blog is about some edge cases you should know before even using swc.\u003c/p\u003e\n\u003cp class=\"hint tip\"\u003eThis blog was written when I used swc \u003cstrong\u003e1.2.51\u003c/strong\u003e, as of this article's publish date.\u003c/p\u003e\n\u003ch2 id=\"older-browsers-support\"\u003eOlder Browsers Support\u003ca href=\"#older-browsers-support\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e🔗\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eDiscussing about older browsers, you might want to ship your code in \u003cstrong\u003eES5\u003c/strong\u003e format. Babel has \u003ca href=\"https://babeljs.io/docs/en/babel-preset-env\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003epreset-env\u003c/a\u003e which actually transpiles all ES5+ syntax to be compatible with ES5.\u003c/p\u003e\n\u003cp\u003eAs mentioned in the previous \u003ca href=\"/blog/esbuild-exploration\"\u003eblog\u003c/a\u003e, esbuild currently does not support ES5 syntax transformations. For safety, you can try esbuild for bundling server code instead or use it in development build like how \u003ca href=\"https://vitejs.dev/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eVite\u003c/a\u003e does.\u003c/p\u003e\n\u003cp\u003eOn the other hand, SWC (what we are going to talk about it in this blog), does support ES5 syntax transformations. Personally I didn't encounter any weird issue with its ES5 syntax transformations prior writing this blog, when trying it out in a large codebase. Set the target to \u003ccode\u003ees5\u003c/code\u003e and if you want, you can explore about \u003ca href=\"https://swc.rs/docs/preset-env/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eswc preset-env\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"discovered-issues\"\u003eDiscovered Issues\u003ca href=\"#discovered-issues\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e🔗\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eBelow are several issues I personally encountered, I personally hope in the future SWC would focus on API stabilization instead.\u003c/p\u003e\n\u003ch3 id=\"export-default-is-not-evaluated\"\u003eExport default is not evaluated\u003ca href=\"#export-default-is-not-evaluated\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e🔗\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThis is a quite interesting thing I just discovered during my years in Frontend development 😅.\nWe have a file called \u003ccode\u003eget.js\u003c/code\u003e, let's take a look about the original code here:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ekey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// code here\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd here's the result from transpiling using SWC:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token string\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token known-class-name class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edefineProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexports\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'__esModule'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  value\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ekey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// code here\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\nexports\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhat do you think would happen if another place import this file? Let's say there is \u003ccode\u003eindex.js\u003c/code\u003e that actually re-export \u003ccode\u003eget.js\u003c/code\u003e file.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token string\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token known-class-name class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edefineProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexports\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'__esModule'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  value\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token known-class-name class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edefineProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexports\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'get'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  enumerable\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003eget\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e _get\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token known-class-name class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edefineProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexports\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'set'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  enumerable\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003eget\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e _set\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token known-class-name class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edefineProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexports\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'del'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  enumerable\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003eget\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e _del\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nexports\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e _get \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003e_interopRequireDefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./get'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e _set \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003e_interopRequireDefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./set'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e _del \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003e_interopRequireDefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./del'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e _default \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  get\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e _get\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  set\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e _set\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  del\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e _del\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nexports\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e _default\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf you try to console \u003ccode\u003e_default\u003c/code\u003e object, it will result in:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  get\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword nil\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  set\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e fn\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  del\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e fn\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOr even scarier, I bundled these as 3rd party library with webpack, resulting in with this error:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eTypeError\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e undefinedundefined is not defined\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhat happened here? I honestly didn't know until I read about this \u003ca href=\"https://github.com/webpack/webpack/issues/7767\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003espec from webpack\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eLessons learned:\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eWhen writing a 3rd party library, we need to be extremely careful by knowing how other bundler works. Especially webpack and rollup, they might have different specs in mind. This is only just one example that things could go very wrong!\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBabel might already be aware about this issue, or we just got off lucky. Babel will transpile into following which actually does the evaluation beforehand:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token string\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token known-class-name class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edefineProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexports\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'__esModule'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  value\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nexports\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// exports function first\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ekey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// code here\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003cp\u003eTo conclude this issue, the safest code when exporting a function is:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ekey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// code here\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhich will transpile to:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token string\"\u003e'use strict'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token known-class-name class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edefineProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexports\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'__esModule'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  value\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nexports\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ekey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// code here\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e _default \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e get\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// evaluate the function first\u003c/span\u003e\nexports\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e _default\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"swc-plugins\"\u003eSWC Plugins\u003ca href=\"#swc-plugins\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e🔗\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eSo I've been writing a swc plugin for emotion that behaves similarly as \u003ca href=\"https://github.com/emotion-js/emotion/tree/master/packages/babel-plugin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ebabel-emotion-plugin\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eSWC plugin as of this blog was written, is highly unstable. See this \u003ca href=\"https://github.com/swc-project/swc/issues/785\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eissue\u003c/a\u003e, even the example plugin is not working. But since it has already been patched, I decided to give it a try as well.\u003c/p\u003e\n\u003cp\u003eBelow are the edge cases that I stumbled upon writing a plugin in version \u003ccode\u003e1.2.51\u003c/code\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eIf you are writing your syntax in commonjs, you must be aware that the \u003ccode\u003eVisitor\u003c/code\u003e class is exported as default. So you need to import it differently:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eVisitor\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'@swc/core/Visitor'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eEmotionStyledTransformer\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVisitor\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003evisitCallExpression\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ee\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// code\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e emotionPlugin \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eEmotionStyledTransformer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nmodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eexports\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e emotionPlugin\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePlugin does not work with \u003ccode\u003etransformFile\u003c/code\u003e, you need to use \u003ccode\u003etransformFileSync\u003c/code\u003e as alternative. Otherwise, it will give you weird \u003ccode\u003eUnexpected token o in JSON\u003c/code\u003e error. This is probably a mishandled logic problem in \u003ccode\u003e@swc/core\u003c/code\u003e, specifically in \u003ccode\u003eparseFile\u003c/code\u003e method (please do correct me if I am wrong here). It is actually doing \u003ccode\u003eJSON.parse(\u0026#x3C;Promise\u003e)\u003c/code\u003e 👻\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e transformFileSync\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e plugins \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'@swc/core'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etransformFileSync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efilename\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    plugin\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003eplugins\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eemotionPlugin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003evisitProgram\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ebind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eemotionPlugin\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003eswcOptions\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ethrow\u003c/span\u003e error\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eYou might encounter error like \u003ccode\u003evisitTsType method is not implemented\u003c/code\u003e. I'm not sure about this, but it seems you can't use plugin together with a typescript file that specifies the typings.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003ca href=\"#conclusion\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e🔗\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eWell, it is how it is. SWC is more alpha version of Babel, so please be extra careful when migrating specifically a large codebase from Babel.\u003c/p\u003e\n\u003cp\u003eDespite having encoutered the issues above, this trial was quite fun, I also have discovered about hidden webpack spec that I wasn't aware of ✌️.\u003c/p\u003e\n\u003cp\u003eNow let's wait for the exciting future: \u003cstrong\u003eesbuild fully supports ES5 syntax transformations\u003c/strong\u003e or \u003cstrong\u003eSWC stabilization\u003c/strong\u003e.\u003c/p\u003e\n\u003chr\u003e\n"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"swc-exploration"},"buildId":"e01ced8e89372b9f7ed3214735cf875e833dbd4a","assetPrefix":"https://josteph.github.io","runtimeConfig":{"GQL_HOST":"/api/dev/graphql"},"nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="https://josteph.github.io/_next/static/chunks/polyfills-8683bd742a84c1edd48c.js"></script><script src="https://josteph.github.io/_next/static/chunks/webpack-b429e1369fc016e42d18.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/framework-73e320d4796cb275c431.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/597-9e7fe0b578c289b3627a.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/288-288c36fbcb66f88991b1.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/main-7713a1ef2965e1d091b8.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/pages/_app-d6d1a2ad44c75b0a7e7c.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/pages/blog/%5Bslug%5D-eccc4aa7201462883f8c.js" async=""></script><script src="https://josteph.github.io/_next/static/e01ced8e89372b9f7ed3214735cf875e833dbd4a/_buildManifest.js" async=""></script><script src="https://josteph.github.io/_next/static/e01ced8e89372b9f7ed3214735cf875e833dbd4a/_ssgManifest.js" async=""></script></body></html>