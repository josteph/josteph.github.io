<!DOCTYPE html><html lang="en"><title>Joshua Stephen</title><meta name="robots" content="index,follow"/><meta name="application-name" content="Joshua Stephen"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="default"/><meta name="apple-mobile-web-app-title" content="Joshua Stephen"/><meta name="description" content="A web developer passionate about javascript all around the web."/><meta name="format-detection" content="telephone=no"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#FFFFFF"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png"/><meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@jostephhh"/><meta name="twitter:creator" content="@jostephhh"/><meta name="twitter:image" content="/icons/apple-icon-120x120.png"/><meta property="og:image" content="/icons/apple-icon-120x120.png"/><meta property="og:type" content="website"/><meta property="og:site_name" content="jostephhh"/><meta property="og:url" content="https://josteph.github.io"/><meta property="og:title" content="Joshua Stephen"/><meta property="og:description" content="A web developer passionate about javascript all around the web."/><link rel="canonical" href="https://josteph.github.io"/><link rel="manifest" href="/manifest.json"/><script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://josteph.github.io/"}</script><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="https://josteph.github.io/_next/static/css/62cba62dadd56e09cef8.css" as="style"/><link rel="stylesheet" href="https://josteph.github.io/_next/static/css/62cba62dadd56e09cef8.css" data-n-g=""/><link rel="preload" href="https://josteph.github.io/_next/static/css/a6d387e8205d6d7502d5.css" as="style"/><link rel="stylesheet" href="https://josteph.github.io/_next/static/css/a6d387e8205d6d7502d5.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="https://josteph.github.io/_next/static/chunks/webpack-6b928cc76d83c2de3682.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/framework-73e320d4796cb275c431.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/597-9e7fe0b578c289b3627a.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/288-288c36fbcb66f88991b1.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/main-7713a1ef2965e1d091b8.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/pages/_app-b1da41c558bd91b5d191.js" as="script"/><link rel="preload" href="https://josteph.github.io/_next/static/chunks/pages/index-ed1e63e253132991827c.js" as="script"/></head><body><div id="__next"><header class="navbar"><nav class="nav-wrapper"><div class="nav-logo"><a href="/">Josteph</a></div></nav></header><main><section class="main-container"><div class="home_page_styMainInfo__14JdO"><h3>Hi, I am <span class="main-gradient">Joshua</span></h3><br/><h4 class="main-gradient">Software Engineer<br/>Web Platform</h4><p>Pleased to meet you!<br/>I mainly deal with Javascript and stuffs related with web.<br/>Currently building great stuffs with the awesome team at <a href="https://www.tokopedia.com">Tokopedia</a>.<br/><br/>Feel free to reach me anytime to have a nice chat together üçª</p></div><div class="home_page_styMainInfo__14JdO home_page_styContactInfo__2XX59"><h4 class="main-gradient">Get In Touch</h4><div><p>The universe is a pretty big place.<br/>You can find me on:</p><ul><li><a target="_blank" rel="noreferrer noopener" href="https://www.linkedin.com/in/josteph22/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg> @josteph22</a></li><li><a target="_blank" rel="noreferrer noopener" href="https://github.com/josteph"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> @josteph</a></li><li><a target="_blank" rel="noreferrer noopener" href="https://twitter.com/jostephhh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg> @jostephhh</a></li></ul></div></div></section><hr/><section class="home_page_styBlogInfo__ifRfr"><h2>Blog</h2><div class="home_page_styBlogDisplay__2tIZO"><h3><a class="ani-link color-normal" href="/blog/esbuild-exploration">Using esbuild As Your New Bundler</a></h3><p class="font-sm">March 8, 2021</p><p>Thoughts regarding esbuild as replacement of existing bundlers &amp; babel for developing packages.</p></div><div class="home_page_styBlogDisplay__2tIZO"><h3><a class="ani-link color-normal" href="/blog/swc-exploration">Exploring SWC as esbuild Alternative</a></h3><p class="font-sm">April 10, 2021</p><p>Comparing with esbuild and list out current issues / edge cases for swc.</p></div></section></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"docs":[{"slug":"esbuild-exploration","meta":{"title":"Using esbuild As Your New Bundler","description":"Thoughts regarding esbuild as replacement of existing bundlers \u0026 babel for developing packages.","published":"March 8, 2021"},"content":"\n# Using esbuild As Your New Bundler\n\nPublished on March 8, 2021\n\n---\n\n## Table of Contents\n\n## Introduction\n\nYou might have heard about [esbuild](https://esbuild.github.io/) before even reading this post. If you did, that's great! But if you never heard about it before this, or at least you haven't tried it, then **you should!**\n\nYou can make esbuild to become either a bundler, or just simply use it as a compiler in replacement of babel.\n\n?\u003e ‚ö†Ô∏è\nesbuild doesn't fully support **es5** syntax yet, you might want to reconsider about this before migrating from babel. You can read about it in this [thread](https://github.com/evanw/esbuild/issues/297).\n\n## Replacing Babel\n\nWe all know about babel, how powerful babel is, and how babel has helped us building great stuffs all around the web. But in for large scale project, you might have experienced that the build time takes very long! This might become one of the biggest productivity blocker.\n\nBabel simply has more overhead cost than esbuild. Even if you cache the loader, esbuild is much much faster. Although, esbuild even put [restriction](https://esbuild.github.io/plugins/#plugin-api-limitations) for when writing plugin, so you might want to know this before really replacing babel, especially if you depend on specific babel plugins that is not present in esbuild.\n\nLet us talk about how to replace babel with esbuild. But before this, you should know that babel can simply take a folder as entry points, but in esbuild you need to **specify** all the file paths that you are going to compile as an array of paths.\n\nI suggest you to start from using **Typescript** because esbuild supports typescript natively, without adding new plugin. Therefore, I can say that probably it doesn't have any performance impact when you are compiling typescript or normal javascript files, unlike Babel.\n\nIf you are using typescript, you can get the list of needed files by using this method:\n\n```js\n// getTSConfig.js\n\nconst ts = require('typescript');\n\nfunction getTSConfig(configPath = 'tsconfig.json') {\n  const tsConfigFile = ts.findConfigFile(process.cwd(), ts.sys.fileExists, configPath);\n\n  if (!tsConfigFile) {\n    throw new Error(`tsconfig.json does not exist in the current directory: ${process.cwd()}`);\n  }\n\n  const configFile = ts.readConfigFile(tsConfigFile, ts.sys.readFile);\n\n  if (configFile.error) {\n    throw new Error(`Cannot read TS configuration file from ${process.cwd()}: ${configFile.error}`);\n  }\n\n  const tsConfig = ts.parseJsonConfigFileContent(configFile.config, ts.sys, process.cwd());\n\n  return { tsConfig, tsConfigFile };\n}\n\nmodule.exports = getTSConfig;\n```\n\nNow, let's pair it together with esbuild:\n\n```js\nconst esbuild = require('esbuild');\nconst getTSConfig = require('./getTSConfig');\n\nasync function build() {\n  const { tsConfig, tsConfigFile } = getTSConfig();\n\n  try {\n    await esbuild.build({\n      color: true,\n      entryPoints: tsConfig.fileNames,\n      outdir: OUT_DIR,\n      loader: {\n        '.js': 'jsx', // if you are also compiling react files\n      },\n      format: 'esm', // can be also 'cjs'\n      target: 'es2015',\n      minify: false,\n      bundle: false,\n      tsconfig: tsConfigFile,\n      plugins: [], // optional\n    });\n  } catch (error) {\n    console.error(error);\n  }\n}\n```\n\nThe example above only shown how to rely on typescript API to discover the files. In case you are not using typescript in your project, there is [a gist](https://gist.github.com/lovasoa/8691344#gistcomment-2927279) that lets you list all the files path in a folder recursively. But don't forget to filter only **.js** or **.jsx** files!\n\n### Compiling other file assets\n\nUsing the configuration above, esbuild will skip to compile every files with extension that typescript unable to read. That means, if you are importing images in your js/ts files, they won't be exported in the out directory. This could lead to build time error.\n\nFortunately, here is a piece of code you might want to consider adding **after the build process is finished**:\n\n```js\nasync function build() {\n  ...\n\n  try {\n    const cpy = require('cpy');\n    const relativeOutDir = path.relative(SRC_DIR, OUT_DIR);\n\n    await cpy(['**', `!**/*.{js,ts,jx,tsx}`], relativeOutDir, {\n      cwd: SRC_DIR,\n      parents: true,\n    });\n  } catch (error) {\n    console.error(error);\n  }\n}\n```\n\n**And you're done!**\n\nIf you are curious about the timing, try logging the time before \u0026 after each processes (build \u0026 copy).\n\n## Using with existing bundler\n\nIf you are using webpack, I suggest you to have a look into [esbuild-loader](https://github.com/privatenumber/esbuild-loader).\n\nIf you are using rollup, there is also existing [plugin](https://github.com/egoist/rollup-plugin-esbuild) to pair with esbuild. You can refer to the [full configuration](https://github.com/josteph/elastic-node-example/blob/main/rollup.config.js) I have tried before writing this post.\n\nThere is not much to be explained, but simply follow the instructions given in their README.\n\n## Conclusion\n\nIt is not easy to fully migrate from existing build tools, there are also many unexplained limitations or edge cases of esbuild in this blog. Although, you may find several testimonies about the significant speed improvements [here](https://github.com/privatenumber/esbuild-loader/issues/13).\n\nIf you previously relied on babel to help optimize your app, this could be a challenge for migrating your existing app. For example you might have been using **babel-plugin-lodash** to help your lodash imports to be cherry-picked. Then you might need to recheck your app vendor's size. But here is the [esbuild plugin](https://github.com/josteph/esbuild-plugin-lodash) to help you get similar behaviour.\n\nIf you are not convinced yet, just give it a try üòâ\n\n---\n"},{"slug":"swc-exploration","meta":{"title":"Exploring SWC as esbuild Alternative","description":"Comparing with esbuild and list out current issues / edge cases for swc.","published":"April 10, 2021"},"content":"\n# Exploring SWC as esbuild Alternative\n\nPublished on April 10, 2021\n\n---\n\n## Table of Contents\n\n## Introduction\n\nIn the last [blog](/blog/esbuild-exporation), we have talked about how to use esbuild programmatically in order to boost your build time performance. Not to forget about babel, a lot of transformations that we are not aware of using it in babel, might not be supported in either esbuild or swc.\n\nAlso a bit disclaimer about using these new build tools written in go / rust, they are **not fully stable yet**. Although they are actively being developed, try to be extra careful when you decide to use this on production!\n\nWhat I am going to discuss in this blog is about some edge cases you should know before even using swc.\n\n## Older Browsers Support\n\nDiscussing about older browsers, you might want to ship your code in **es5** format. Babel has [preset-env](https://babeljs.io/docs/en/babel-preset-env) which actually transpiles all es5+ syntax to be compatible with es5.\n\nAs mentioned in the previous [blog](/blog/esbuild-exporation), esbuild currently does not support es5 syntax transformations. For safety, you can try esbuild for bundling server code instead.\n\nOn the other hand, SWC (what we are going to talk about it in this blog), does support ES5 syntax transformations. Personally I haven't found any weird issue with its es5 syntax transformations prior writing this blog, when trying it out in a large codebase. Set the target to `es5` and if you want, you can explore about [swc preset-env](https://swc.rs/docs/preset-env/).\n\n## Discovered Issues\n\n### Export default is not evaluated\n\nThis is a quite interesting thing I just discovered during my years in Frontend development üòÖ.\nWe have a file called `get.js`, let's take a look about the original code here:\n\n```js\nexport default function get(key) {\n  // code here\n}\n```\n\nAnd here's the result from transpiling using SWC:\n\n```js\n'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true,\n});\n\nfunction get(key) {\n  // code here\n}\n\nexports.default = get;\n```\n\nWhat do you think would happen if another place import this file? Let's say there is `index.js` that actually re-export `get.js` file.\n\n```js\n'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true,\n});\nObject.defineProperty(exports, 'get', {\n  enumerable: true,\n  get: function get() {\n    return _get.default;\n  },\n});\nObject.defineProperty(exports, 'set', {\n  enumerable: true,\n  get: function get() {\n    return _set.default;\n  },\n});\nObject.defineProperty(exports, 'del', {\n  enumerable: true,\n  get: function get() {\n    return _del.default;\n  },\n});\nexports.default = void 0;\n\nvar _get = _interopRequireDefault(require('./get'));\n\nvar _set = _interopRequireDefault(require('./set'));\n\nvar _del = _interopRequireDefault(require('./del'));\n\nvar _default = {\n  get: _get.default,\n  set: _set.default,\n  del: _del.default,\n};\nexports.default = _default;\n```\n\nIf you try to console `_default` object, it will result in:\n\n```js\n{\n  get: undefined,\n  set: fn,\n  del: fn,\n}\n```\n\nOr even scarier, I bundled these as 3rd party library with webpack, resulting in with this error:\n\n```js\nTypeError: undefinedundefined is not defined\n```\n\nWhat happened here? I honestly didn't know until I read about this [spec from webpack](https://github.com/webpack/webpack/issues/7767).\n\n**Lessons learned:**\n\n1. When writing a 3rd party library, we need to be extremely careful by knowing how other bundler works. Especially webpack and rollup, they might have different specs in mind. This is only just one example that things could go very wrong!\n\n2. Babel might already be aware about this issue, or we just got off lucky. Babel will transpile into following which actually does the evaluation beforehand:\n\n   ```js\n   'use strict';\n\n   Object.defineProperty(exports, '__esModule', {\n     value: true,\n   });\n\n   exports.default = get; // exports function first\n\n   function get(key) {\n     // code here\n   }\n   ```\n\n---\n\nTo conclude this issue, the safest code when exporting a function is:\n\n```js\nfunction get(key) {\n  // code here\n}\n\nexport default get;\n```\n\nWhich will transpile to:\n\n```js\n'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true,\n});\nexports.default = void 0;\n\nfunction get(key) {\n  // code here\n}\n\nvar _default = get; // evaluate the function first\nexports.default = _default;\n```\n\n### Current state of SWC\n\nSo I've been writing a swc plugin for emotion that behaves similarly as [babel-emotion-plugin](https://github.com/emotion-js/emotion/tree/master/packages/babel-plugin).\n\nSWC plugin as of this blog was written, is highly unstable. See this [issue](https://github.com/swc-project/swc/issues/785), even the example plugin is not working. But since it has already been patched, I decided to give it a try as well.\n\nBelow are the edge cases that I stumbled upon writing a plugin in version `1.2.51`\n\n1. If you are writing your syntax in commonjs, you must be aware that the `Visitor` class is exported as default. So you need to import it differently:\n\n   ```js\n   const Visitor = require('@swc/core/Visitor').default;\n\n   class EmotionStyledTransformer extends Visitor {\n     visitCallExpression(e) {\n       // code\n     }\n   }\n\n   const emotionPlugin = new EmotionStyledTransformer();\n\n   module.exports = emotionPlugin;\n   ```\n\n2. Plugin does not work with `transformFile`, you need to use `transformFileSync` as alternative. Otherwise, it will give you weird `Unexpected token o in JSON` error. This is probably a mishandled logic problem in `@swc/core`, specifically in `parseFile` method (please do correct me if I am wrong here). It is actually doing `JSON.parse(\u003cPromise\u003e)` üëª\n\n   ```js\n   const { transformFileSync } = require('@swc/core');\n\n   try {\n     const result = transformFileSync(filename, {\n       plugin: plugins([emotionPlugin.visitProgram.bind(emotionPlugin)]),\n       ...swcOptions,\n     });\n\n     return result;\n   } catch (error) {\n     throw error;\n   }\n   ```\n\n3. You might encounter error like `visitTsType method is not implemented`. I'm not sure about this, but it seems you can't use plugin together with a typescript file that specifies the typings.\n\n## Conclusion\n\nWell, it is how it is. SWC is more alpha version of Babel, so please be extra careful when migrating specifically a large codebase from Babel.\n\nDespite encoutered the issues above, this trial was quite fun, I also have discovered about hidden webpack spec that I wasn't aware of ‚úåÔ∏è.\n\nNow let's wait for the exciting future: **esbuild fully supports es5** or **SWC is stabilized**.\n\n---\n"}]},"__N_SSG":true},"page":"/","query":{},"buildId":"6c1ad5f7f718b461bb936b802e1ec84dfeeb4e5a","assetPrefix":"https://josteph.github.io","runtimeConfig":{"GQL_HOST":"/api/dev/graphql"},"nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="https://josteph.github.io/_next/static/chunks/polyfills-8683bd742a84c1edd48c.js"></script><script src="https://josteph.github.io/_next/static/chunks/webpack-6b928cc76d83c2de3682.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/framework-73e320d4796cb275c431.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/597-9e7fe0b578c289b3627a.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/288-288c36fbcb66f88991b1.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/main-7713a1ef2965e1d091b8.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/pages/_app-b1da41c558bd91b5d191.js" async=""></script><script src="https://josteph.github.io/_next/static/chunks/pages/index-ed1e63e253132991827c.js" async=""></script><script src="https://josteph.github.io/_next/static/6c1ad5f7f718b461bb936b802e1ec84dfeeb4e5a/_buildManifest.js" async=""></script><script src="https://josteph.github.io/_next/static/6c1ad5f7f718b461bb936b802e1ec84dfeeb4e5a/_ssgManifest.js" async=""></script></body></html>